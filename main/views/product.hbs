{{#> mainLayout}}
{{#if productDetail}}
<script src="/image_upload.js"></script>
<!-- default icons used in the plugin are from Bootstrap 5.x icon library (which can be enabled by loading CSS below) -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.min.css" crossorigin="anonymous">
<!-- the fileinput plugin styling CSS file -->
<link href="https://cdn.jsdelivr.net/gh/kartik-v/bootstrap-fileinput@5.2.5/css/fileinput.min.css" media="all" rel="stylesheet" type="text/css" />
<!-- the jQuery Library -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js" crossorigin="anonymous"></script>
 
<!-- piexif.min.js is needed for auto orienting image files OR when restoring exif data in resized images and when you
    wish to resize images before upload. This must be loaded before fileinput.min.js -->
<script src="https://cdn.jsdelivr.net/gh/kartik-v/bootstrap-fileinput@5.2.5/js/plugins/piexif.min.js" type="text/javascript"></script>
 
<!-- bootstrap.bundle.min.js below is needed if you wish to zoom and preview file content in a detail modal
    dialog. bootstrap 5.x or 4.x is supported. You can also use the bootstrap js 3.3.x versions. -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
 
<!-- the main fileinput plugin script JS file -->
<script src="https://cdn.jsdelivr.net/gh/kartik-v/bootstrap-fileinput@5.2.5/js/fileinput.min.js"></script>
<h1>{{ productDetail.name }} {{ productDetail.model_no }}</h1>
<div class="btn-group mt-1 mb-3 d-flex justify-content-between">
    <div>
        <a href="/product/edit/{{ productDetail.id }}" class="btn btn-outline-primary">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                class="bi bi-pencil-square mb-1" viewBox="0 0 16 16">
                <path
                    d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z" />
                <path fill-rule="evenodd"
                    d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5v11z" />
            </svg>
            Edit
        </a>
        <a href="/product/edit/{{ productDetail.model_no }}/image" class="btn btn-outline-primary">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                class="bi bi-pencil-square mb-1" viewBox="0 0 16 16">
                <path
                    d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z" />
                <path fill-rule="evenodd"
                    d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5v11z" />
            </svg>
            Edit Image
        </a>
        <a type="button" class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#exampleModal">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                class="bi bi-pencil-square mb-1" viewBox="0 0 16 16">
                <path
                    d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z" />
                <path fill-rule="evenodd"
                    d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5v11z" />
            </svg>
            Upload Image
        </a>
        <a href="https://www.kickscrew.com/search?q={{ productDetail.model_no }}" class="btn btn-outline-primary">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                class="bi bi-box-arrow-up-right mb-1" viewBox="0 0 16 16">
                <path fill-rule="evenodd"
                    d="M8.636 3.5a.5.5 0 0 0-.5-.5H1.5A1.5 1.5 0 0 0 0 4.5v10A1.5 1.5 0 0 0 1.5 16h10a1.5 1.5 0 0 0 1.5-1.5V7.864a.5.5 0 0 0-1 0V14.5a.5.5 0 0 1-.5.5h-10a.5.5 0 0 1-.5-.5v-10a.5.5 0 0 1 .5-.5h6.636a.5.5 0 0 0 .5-.5z" />
                <path fill-rule="evenodd"
                    d="M16 .5a.5.5 0 0 0-.5-.5h-5a.5.5 0 0 0 0 1h3.793L6.146 9.146a.5.5 0 1 0 .708.708L15 1.707V5.5a.5.5 0 0 0 1 0v-5z" />
            </svg>
            Search on Shopify
        </a>
        <a href="/product/calculateStock/{{ productDetail.id }}" class="btn btn-outline-primary fetch-link"
            data-loading-text="Recalculating Price / Stock" data-loaded-text='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-check-lg" viewBox="0 0 16 16">
                <path d="M12.736 3.97a.733.733 0 0 1 1.047 0c.286.289.29.756.01 1.05L7.88 12.01a.733.733 0 0 1-1.065.02L3.217 8.384a.757.757 0 0 1 0-1.06.733.733 0 0 1 1.047 0l3.052 3.093 5.4-6.425a.247.247 0 0 1 .02-.022Z"/>
            </svg> Recalculated Price / Stock' data-loaded-class="btn btn-outline-success fetch-link">
            Recalculate Price / Stock
        </a>
        <a href="/product/resyncProduct/{{ productDetail.id }}" class="btn btn-outline-primary fetch-link"
            data-loading-text="Resync Product" data-loaded-text='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-send-check-fill" viewBox="0 0 16 16">
  <path d="M15.964.686a.5.5 0 0 0-.65-.65L.767 5.855H.766l-.452.18a.5.5 0 0 0-.082.887l.41.26.001.002 4.995 3.178 1.59 2.498C8 14 8 13 8 12.5a4.5 4.5 0 0 1 5.026-4.47L15.964.686Zm-1.833 1.89L6.637 10.07l-.215-.338a.5.5 0 0 0-.154-.154l-.338-.215 7.494-7.494 1.178-.471-.47 1.178Z"/>
  <path d="M16 12.5a3.5 3.5 0 1 1-7 0 3.5 3.5 0 0 1 7 0Zm-1.993-1.679a.5.5 0 0 0-.686.172l-1.17 1.95-.547-.547a.5.5 0 0 0-.708.708l.774.773a.75.75 0 0 0 1.174-.144l1.335-2.226a.5.5 0 0 0-.172-.686Z"/>
</svg> Resync Product' data-loaded-class="btn btn-outline-success fetch-link">
            Re-sync Product
        </a>
        <a href="/product/resyncImage/{{ productDetail.model_no }}" class="btn btn-outline-primary fetch-link"
            data-loading-text="Re-syncing Image" data-loaded-text='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-check-lg" viewBox="0 0 16 16">
                <path d="M12.736 3.97a.733.733 0 0 1 1.047 0c.286.289.29.756.01 1.05L7.88 12.01a.733.733 0 0 1-1.065.02L3.217 8.384a.757.757 0 0 1 0-1.06.733.733 0 0 1 1.047 0l3.052 3.093 5.4-6.425a.247.247 0 0 1 .02-.022Z"/>
            </svg> Re-synced Image' data-loaded-class="btn btn-outline-success fetch-link">
            Re-sync Image
        </a>
    </div>
    <div>
        <a href="/product/softdelete/{{ productDetail.id }}" class="btn btn-warning"
            onclick="return confirm('This action [Hide Product] cannot be undone.\nThis action will archive the product in database and online store.\nAre you sure?')">
            Hide Product
        </a>
    </div>
</div>
<div class="row">
    {{#each images}}
    <div class="col-2">
        <img src="{{this}}" class="img-thumbnail" alt="...">
    </div>
    {{/each}}
</div>
<table class="table table-striped table-hover">
    <tbody>
        <tr>
            <th>Product#</th>
            <td>{{productDetail.modelno}}</td>
        </tr>
        <tr>
            <th>Product#2</th>
            <td>{{productDetail.model_no}}</td>
        </tr>
        <tr>
            <th>Model Name</th>
            <td>{{productDetail.name}}</td>
        </tr>
        <tr>
            <th>Series</th>
            <td>{{productDetail.series}}</td>
        </tr>
        <tr>
            <th>Made In</th>
            <td>{{productDetail.made_in}}</td>
        </tr>
        <tr>
            <th>Color</th>
            <td>{{productDetail.color}}</td>
        </tr>
        <tr>
            <th>Color Option in Magento</th>
            <td>
                {{#each detailColorOpt}}
                {{#if this.optionSelected}}{{this.eng}} {{this.cht}}{{/if}}
                {{/each}}
            </td>
        </tr>
        <tr>
            <th>Retail Price(HKD)</th>
            <td>{{productDetail.price}}</td>
        </tr>
        <tr>
            <th>
                Categories
            </th>
            <td>
                {{#each categories}}
                {{#if @first}}
                {{this}}
                {{else}}
                >> {{this}}
                {{/if}}
                {{/each}}
            </td>
        </tr>
        <tr>
            <th>Gender</th>
            <td>{{#each selectedGender}}{{this.name}}{{/each}}</td>
        </tr>
        <tr>
            <th>Type</th>
            <td>{{#each selectedType}}{{this.name}}&emsp;{{/each}}</td>
        </tr>
        <tr>
            <th>Location</th>
            <td>
                {{#each selectedLocation}}{{this.name}}&emsp;{{/each}}
            </td>
        </tr>
        <tr>
            <th>Payment Gateway</th>
            <td>{{detailPayment}}</td>
        </tr>
        <tr>
            <th>Release Date</th>
            <td>{{productDetail.releasedate}}</td>
        </tr>
        <tr>
            <th>Sort Date</th>
            <td>{{productDetail.sortdate}}</td>
        </tr>
        {{#if showShopify}}
        <tr>
            <th>Shopify Vendor</th>
            <td>{{productDetail.vendor}}</td>
        </tr>
        <tr>
            <th>Shopify Product Type</th>
            <td>{{productDetail.product_type}}</td>
        </tr>
        <tr>
            <th>Shopify status</th>
            <td>
                {{status}}
            </td>
        </tr>
        <tr>
            <th>Shopify Description({{#if (eq showShopifyDescription 1)}}Show{{else}}Not Show{{/if}})</th>
            <td>
                {{{description}}}
            </td>
        </tr>
        {{/if}}
    </tbody>
</table>

<table class="table table-striped table-hover">
    <tbody>
        <tr>
            <th colspan="2">Variants</th>
        </tr>
        <tr>
            <td colspan="2">
                {{#if productDetail.variants}}
                <table class="table table-striped table-hover">
                    <tbody>
                        <tr>
                            <th>SKU</th>
                            <th>Size</th>
                            <th>Price</th>
                            <th>Quantity</th>
                            <th></th>
                        </tr>
                        {{#each productDetail.variants}}
                        <tr>
                            <td>{{this.sku}}</td>
                            <td>{{this.size}}</td>
                            <td>{{this.price}}</td>
                            <td>{{this.qty}}</td>
                            <td>
                                {{#if this.sku}}
                                <a href="/product/calculateSku/{{ this.sku }}"
                                    class="btn btn-outline-primary fetch-link" data-loading-text="Recalculating Variant"
                                    data-loaded-text='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-check-lg" viewBox="0 0 16 16">
                <path d="M12.736 3.97a.733.733 0 0 1 1.047 0c.286.289.29.756.01 1.05L7.88 12.01a.733.733 0 0 1-1.065.02L3.217 8.384a.757.757 0 0 1 0-1.06.733.733 0 0 1 1.047 0l3.052 3.093 5.4-6.425a.247.247 0 0 1 .02-.022Z"/>
            </svg> Recalculated Variant' data-loaded-class="btn btn-outline-success fetch-link">
                                    Recalculate Variant
                                </a>
                                {{/if}}
                            </td>
                        </tr>
                        {{/each}}
                    </tbody>
                </table>
                {{/if}}
            </td>
        </tr>
        {{!-- <tr>
            <th>Images</th>
            <td>
                {{#each images}}
                <div>
                    <a href="{{sourcePath}}" target="_blank"
                        class="d-block mb-1 me-1 float-start{{#unless isOnShopify}} crossout{{/unless}}">
                        <img src="{{sourcePath}}" class="product-img img-thumbnail" />
                    </a>
                </div>
                {{/each}}
            </td>
        </tr> --}}
    </tbody>
</table>
<!-- Modal -->
<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
        <form id="uploadImageForm" enctype="multipart/form-data">
            <div class="modal-header">
                <h5 class="modal-title">{{ productDetail.name }} {{ productDetail.model_no }}</h5>
            </div>
            <div class="modal-body">
                <div>
                    <input id="image_uploads" name="image_uploads" type="file" class="file" multiple accept=".jpg, .jpeg, .png, .gif"
                        data-show-upload="false" data-show-caption="true" data-msg-placeholder="Select {files} for upload...">
                    <input type="text" hidden value="{{ productDetail.id }}" id="pid">
                    <input type="text" hidden value="{{ productDetail.model_no }}" id="modelNumber">
                    <br>
                    <div class="card">
                        <div class="card-header">
                            Create square image
                        </div>
                        <div class="card-body" id="squarcheck">
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button class="btn btn-primary">Submit</button>
            </div>
        </form>
    </div>
  </div>
</div>
{{else}}
<div>
    Product <span class="fw-bold">{{ model_no }}</span> not found
</div>
{{/if}}
{{/mainLayout}}
